module.exports=function(t){var n={};function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=n,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)i.d(e,a,function(n){return t[n]}.bind(null,a));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=11)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["components/Select"]},function(t,n){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["components/Alert"]},function(t,n){t.exports=flarum.core.compat["components/LoadingModal"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n,i){"use strict";i.r(n);var e=i(0),a=i.n(e);function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function r(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}var l=i(2),c=i.n(l),u=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),a=0;a<i;a++)e[a]=arguments[a];return r(s(n=t.call.apply(t,[this].concat(e))||this),"key",c.a.attribute("key")),r(s(n),"locales",c.a.attribute("locales")),n}return o(n,t),n}(c.a),f=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),a=0;a<i;a++)e[a]=arguments[a];return r(s(n=t.call.apply(t,[this].concat(e))||this),"key",c.a.attribute("key")),r(s(n),"locale",c.a.attribute("locale")),r(s(n),"value",c.a.attribute("value")),n}return o(n,t),n.prototype.apiEndpoint=function(){return"/fof/linguist/strings"+(this.exists?"/"+this.data.id:"")},n}(c.a),g=i(5),p=i.n(g),h=i(6),d=i.n(h);function y(){return(y=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])}return t}).apply(this,arguments)}var v=i(1),F=i.n(v),b=i(3),w=i.n(b),x=i(4),k=i.n(x),L=i(7),T=i.n(L),O=i(8),P=i.n(O),C=function(){var t=[];for(var n in a.a.data.locales)a.a.data.locales.hasOwnProperty(n)&&t.push({key:n,name:a.a.data.locales[n]});return t},B=i(9),E=i.n(B),N=function(t,n){if(!n)return t;var i=n.toLowerCase(),e=new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");return t.replace(e,"<fof-highlight>$&<fof-highlight>").split("<fof-highlight>").map((function(t){return t.toLowerCase()===i?m("span.FoF-Linguist-Highlight",t):t}))},S=function(){function t(){}var n=t.prototype;return n.oninit=function(t){var n=this;this.stringKey=t.attrs.stringKey,this.locale=t.attrs.locale,this.localeKey=this.locale?this.locale.key:null,this.originalString=this.localeKey&&this.stringKey.locales().hasOwnProperty(this.localeKey)?this.stringKey.locales()[this.localeKey]:null,this.string=a.a.store.all("fof-linguist-string").find((function(t){return t.key()===n.stringKey.key()&&t.locale()===n.localeKey})),this.value=this.string?this.string.value():"",this.dirty=!1,this.processing=!1;var i=Object.keys(this.stringKey.locales()).some((function(t){return-1!==n.stringKey.locales()[t].indexOf("\n")}));this.inputType="input",(i||-1!==this.value.indexOf("\n"))&&(this.inputType="textarea")},n.view=function(t){var n=this,i=this.originalString?this.originalString:"("+a.a.translator.trans("fof-linguist.admin.placeholder."+(this.localeKey?"not-translated":"all-locales"))+")";return m(".FoF-Linguist-Locale",[m("label.FoF-Linguist-Label",this.localeName()),m(".FoF-Linguist-Field",{className:(this.value?"FoF-Linguist-Field--with-value":"")+(this.originalString?" FoF-Linguist-Field--with-original-string":""),title:i},[m(".FoF-Linguist-Field-Wrap",[m(this.inputType,{className:"FormControl FoF-Linguist-Input",value:this.value,oninput:function(t){n.value=t.target.value,n.dirty=!0,n.value||n.string||(n.dirty=!1)},disabled:this.processing}),m(".FoF-Linguist-Placeholder",[m("span.FoF-Linguist-Placeholder-Hint",a.a.translator.trans("fof-linguist.admin.placeholder.hint"))," ",m("span",this.originalString?N(i,t.attrs.highlight):i)])])]),m(".FoF-Linguist-Controls",this.actions(t.attrs.onchange).toArray())])},n.localeName=function(){return this.locale?[this.locale.name+" (",m("code",this.locale.key),")"]:a.a.translator.trans("fof-linguist.admin.locales.all")},n.actions=function(t){var n=this,i=new E.a;return i.add("apply",F.a.component({type:"button",className:"Button Button--primary",loading:this.processing,disabled:!this.dirty,onclick:function(){n.saveString(t)}},a.a.translator.trans("fof-linguist.admin.buttons.apply"))),i.add("reset",F.a.component({type:"button",className:"Button",loading:this.processing,disabled:!this.dirty&&!this.string,onclick:function(){n.deleteString(t)}},a.a.translator.trans("fof-linguist.admin.buttons.reset"))),this.originalString&&i.add("copy-original",F.a.component({type:"button",className:"Button",loading:this.processing,onclick:function(){n.value=n.originalString,n.dirty=!0}},a.a.translator.trans("fof-linguist.admin.buttons.copy-original"))),i},n.saveString=function(t){var n=this;this.value?(this.string||(this.string=a.a.store.createRecord("fof-linguist-string",{attributes:{key:this.stringKey.key(),locale:this.localeKey,value:""}})),this.string.data.attributes.value=this.value,this.string.locale()||delete this.string.data.attributes.locale,this.processing=!0,this.string.save(this.string.data.attributes).then((function(){n.processing=!1,n.dirty=!1,t(),m.redraw()})).catch((function(t){throw n.processing=!1,t}))):this.deleteString(t)},n.deleteString=function(t){var n=this;this.string?(this.processing=!0,this.string.delete().then((function(){n.processing=!1,n.dirty=!1,n.string=null,n.value="",t(),m.redraw()})).catch((function(t){throw n.processing=!1,t}))):(this.value="",this.dirty=!1)},t}(),I=function(){function t(){}return t.prototype.view=function(t){var n=t.attrs,i=n.stringKey,e=n.highlight,a=n.onchange;return m(".FoF-Linguist-Key",[m(".FoF-Linguist-Key-Code",m("code",N(i.key(),e))),m(".FoF-Linguist-Locales",[].concat(C().map((function(t){return m(S,{key:t.key,locale:t,stringKey:i,highlight:e,onchange:a})})),[m(S,{key:"all",locale:null,stringKey:i,highlight:e,onchange:a})]))])},t}(),K=function(t){var n=a.a.translator.translations["fof-linguist.admin.known-namespace."+t];return n||t},j=function(){function t(){}var n=t.prototype;return n.oninit=function(t){this.numberOfResultsToShow=20,this.filters=y({search:"",withOwnTranslations:!1,missingTranslationsNegation:"without",missingTranslationsType:"any",missingTranslationsInLocale:null,forExtension:null},t.attrs.initialBrowseFilters||{}),this.results=[],this.applyFilters()},n.view=function(t){var n=this,i=this.results.slice(0,this.numberOfResultsToShow);return[m("div","1"===a.a.data.settings["fof.linguist.should-clear-cache"]?T.a.component({dismissible:!1,controls:[F.a.component({className:"Button Button--link",onclick:function(){a.a.modal.show(P.a),a.a.request({method:"DELETE",url:a.a.forum.attribute("apiUrl")+"/cache"}).then((function(){return window.location.reload()}))}},a.a.translator.trans("fof-linguist.admin.clear-cache.button"))]},a.a.translator.trans("fof-linguist.admin.clear-cache.text")):null),m(".FoF-Linguist-Filters",[m("input.FormControl",{value:this.filters.search,oninput:function(t){n.filters.search=t.target.value,n.applyFilters()},placeholder:a.a.translator.trans("fof-linguist.admin.filters.search")}),F.a.component({className:"Button"+(this.filters.withOwnTranslations?" FoF-Linguist-Filter--Selected":""),icon:"far fa-"+(this.filters.withOwnTranslations?"check-square":"square"),onclick:function(){n.filters.withOwnTranslations=!n.filters.withOwnTranslations,n.applyFilters()}},a.a.translator.trans("fof-linguist.admin.filters.with-own-translations")),w.a.component({buttonClassName:"Button"+(this.filters.forExtension?" FoF-Linguist-Filter--Selected":""),label:a.a.translator.trans("fof-linguist.admin.filters.for-extension")},t.attrs.namespaces.map((function(t){return F.a.component({className:"Button",icon:"far fa-"+(n.filters.forExtension===t.namespace?"check-square":"square"),onclick:function(i){n.filters.forExtension===t.namespace?n.filters.forExtension=null:n.filters.forExtension=t.namespace,n.applyFilters()}},t.extension?t.extension.extra["flarum-extension"].title:K(t.namespace))}))),w.a.component({buttonClassName:"Button"+(this.filters.missingTranslationsInLocale?" FoF-Linguist-Filter--Selected":""),label:a.a.translator.trans("fof-linguist.admin.filters.missing")},[m(".FoF-Linguist-Missing-Filter",{onclick:function(t){t.stopPropagation()}},[k.a.component({value:this.filters.missingTranslationsNegation,onchange:function(t){n.filters.missingTranslationsNegation=t,n.filters.missingTranslationsInLocale&&n.applyFilters()},options:{without:a.a.translator.trans("fof-linguist.admin.filters.negation-options.without"),with:a.a.translator.trans("fof-linguist.admin.filters.negation-options.with")}}),k.a.component({value:this.filters.missingTranslationsType,onchange:function(t){n.filters.missingTranslationsType=t,n.filters.missingTranslationsInLocale&&n.applyFilters()},options:{any:a.a.translator.trans("fof-linguist.admin.filters.type-options.any"),original:a.a.translator.trans("fof-linguist.admin.filters.type-options.original"),own:a.a.translator.trans("fof-linguist.admin.filters.type-options.own")}}),m("p",a.a.translator.trans("fof-linguist.admin.filters.missing-middle-label"))])].concat(C().map((function(t){return F.a.component({className:"Button",icon:"far fa-"+(n.filters.missingTranslationsInLocale===t.key?"check-square":"square"),onclick:function(){n.filters.missingTranslationsInLocale===t.key?n.filters.missingTranslationsInLocale=null:n.filters.missingTranslationsInLocale=t.key,n.applyFilters()}},t.name+" ("+t.key+")")}))))]),m("div",i.map((function(t){return m(I,{key:t.id(),stringKey:t,highlight:n.filters.search,onchange:function(){a.a.data.settings["fof.linguist.should-clear-cache"]="1"}})}))),m(".FoF-Linguist-Results",[a.a.translator.trans("fof-linguist.admin.filters.results",{shown:i.length+"",total:this.results.length+""})," ",this.results.length>i.length?F.a.component({className:"Button",onclick:function(){n.numberOfResultsToShow+=20}},a.a.translator.trans("fof-linguist.admin.buttons.load-more")):null])]},n.applyFilters=function(){var t=this;this.numberOfResultsToShow=20;var n=a.a.store.all("fof-linguist-string").map((function(t){return t.key()})),i={};C().forEach((function(t){i[t.key]=a.a.store.all("fof-linguist-string").filter((function(n){return n.locale()===t.key})).map((function(t){return t.key()}))}));var e="";this.filters.search&&(e=this.filters.search.toLowerCase()),this.results=a.a.store.all("fof-linguist-string-key").filter((function(a){if(t.filters.withOwnTranslations&&-1===n.indexOf(a.key()))return!1;if(t.filters.missingTranslationsInLocale){var s=a.locales().hasOwnProperty(t.filters.missingTranslationsInLocale),o=-1!==i[t.filters.missingTranslationsInLocale].indexOf(a.key()),r=!1;switch(t.filters.missingTranslationsType){case"any":r=s||o;break;case"original":r=s;break;case"own":r=o}if("without"===t.filters.missingTranslationsNegation&&(r=!r),!r)return!1}if(t.filters.forExtension&&0!==a.key().indexOf(t.filters.forExtension+"."))return!1;if(e){if(-1!==a.key().toLowerCase().indexOf(e))return!0;var l=a.locales();for(var c in l)if(l.hasOwnProperty(c)&&-1!==l[c].toLowerCase().indexOf(e))return!0;return!1}return!0})),m.redraw()},t}(),M=i(10),_=i.n(M),q=function(){function t(){}var n=t.prototype;return n.oninit=function(){this.columns="locale",this.totalPercent=!0,this.locale=[];var t=C().find((function(t){return"en"!==t.key}));t&&(this.locale=t.key)},n.view=function(t){var n=this;return[m(".FoF-Linguist-Filters",[m(".ButtonGroup",[F.a.component({className:"Button"+(this.totalPercent?" active":""),onclick:function(){n.totalPercent=!0}},a.a.translator.trans("fof-linguist.admin.coverage.total-options.percent")),F.a.component({className:"Button"+(this.totalPercent?" ":" active"),onclick:function(){n.totalPercent=!1}},a.a.translator.trans("fof-linguist.admin.coverage.total-options.count"))]),m(".ButtonGroup",[F.a.component({className:"Button"+("locale"===this.columns?" active":""),onclick:function(){n.columns="locale"}},a.a.translator.trans("fof-linguist.admin.coverage.column-options.locale")),F.a.component({className:"Button"+("namespace"===this.columns?" active":""),onclick:function(){n.columns="namespace"}},a.a.translator.trans("fof-linguist.admin.coverage.column-options.namespace"))]),"namespace"===this.columns?m(".ButtonGroup",C().map((function(t){return F.a.component({className:"Button"+(n.locale===t.key?" active":""),onclick:function(){n.locale!==t.key&&(n.locale=t.key)}},t.name+" ("+t.key+")")}))):null]),m("table.FoF-Linguist-Coverage",[m("thead",m("tr",[m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.namespace")),"locale"===this.columns?C().map((function(t){return m("th",t.name+" ("+t.key+")")})):[m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.total")),m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.forum")),m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.admin")),m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.lib")),m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.ref")),m("th",a.a.translator.trans("fof-linguist.admin.coverage.columns.api"))]])),m("tbody",["locale"===this.columns?m("tr",[m("td",[m("span.FoF-Linguist-Coverage-Extension-Icon.FoF-Linguist-Coverage-Namespace-Icon"),m("span.FoF-Linguist-Coverage-Extension-Title",a.a.translator.trans("fof-linguist.admin.coverage.all-namespaces"))]),C().map((function(i){return m("td",m(".FoF-Linguist-Coverage-Progress-Wrap",[n.localeCoverage("",i.key),n.filterButton((function(){t.attrs.browseWithFilters({missingTranslationsInLocale:i.key})}))]))}))]):null,t.attrs.namespaces.map((function(i){return m("tr",[m("td",i.extension?[m("span.FoF-Linguist-Coverage-Extension-Icon",{style:i.extension.icon},i.extension.icon?_()(i.extension.icon.name):""),m("span.FoF-Linguist-Coverage-Extension-Title",i.extension.extra["flarum-extension"].title)]:[m("span.FoF-Linguist-Coverage-Extension-Icon.FoF-Linguist-Coverage-Namespace-Icon"),m("span.FoF-Linguist-Coverage-Extension-Title",K(i.namespace))]),"locale"===n.columns?C().map((function(e){return m("td",m(".FoF-Linguist-Coverage-Progress-Wrap",[n.localeCoverage(i.namespace+".",e.key),n.filterButton((function(){t.attrs.browseWithFilters({forExtension:i.namespace,missingTranslationsInLocale:e.key})}))]))})):[m("td",m(".FoF-Linguist-Coverage-Progress-Wrap",[n.prefixCoverage(i.namespace+"."),n.filterButton((function(){t.attrs.browseWithFilters({forExtension:i.namespace,missingTranslationsInLocale:n.locale})}))])),m("td",n.prefixCoverage(i.namespace+".forum.")),m("td",n.prefixCoverage(i.namespace+".admin.")),m("td",n.prefixCoverage(i.namespace+".lib.")),m("td",n.prefixCoverage(i.namespace+".ref.")),m("td",n.prefixCoverage(i.namespace+".api."))]])}))])])]},n.prefixCoverage=function(t){return this.locale?this.localeCoverage(t,this.locale):null},n.localeCoverage=function(t,n){var i=a.a.store.all("fof-linguist-string-key").filter((function(n){return 0===n.key().indexOf(t)}));if(0===i.length)return"-";var e=0,s=0;i.forEach((function(t){a.a.store.all("fof-linguist-string").find((function(i){return i.key()===t.key()&&i.locale()===n}))?e++:t.locales().hasOwnProperty(n)&&s++}));var o,r,l=Math.round((e+s)/i.length*100);return 100===l?o="full":l<5&&(o="low"),r=this.totalPercent?a.a.translator.trans("fof-linguist.admin.coverage.count.percent",{percent:l+""}):a.a.translator.trans("fof-linguist.admin.coverage.count.total",{translated:e+s+"",total:i.length}),m(".FoF-Linguist-Progress",{className:o?"FoF-Linguist-Progress--"+o:""},[m(".FoF-Linguist-Progress-Bar",{style:{width:Math.max(l,5)+"%"}}),m(".FoF-Linguist-Progress-Label",r),m(".FoF-Linguist-Progress-More",a.a.translator.trans("fof-linguist.admin.coverage.count.details",{total:i.length,original:s+"",custom:e+""}))])},n.filterButton=function(t){return F.a.component({icon:"fas fa-filter",className:"Button Button--icon",onclick:function(){t()},title:a.a.translator.trans("fof-linguist.admin.coverage.apply-missing-filter")})},t}(),R=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var i=n.prototype;return i.oninit=function(n){var i=this;t.prototype.oninit.call(this,n),this.tab="strings",this.ready=!1,this.namespaces=[],this.initialBrowseFilters={},Promise.all([a.a.request({method:"GET",url:a.a.forum.attribute("apiUrl")+"/fof/linguist/strings"}).then((function(t){a.a.store.pushPayload(t)})),a.a.request({method:"GET",url:a.a.forum.attribute("apiUrl")+"/fof/linguist/string-keys"}).then((function(t){var n=a.a.store.pushPayload(t),e=[];n.forEach((function(t){var n=t.key().split(".")[0];-1===["core","validation"].indexOf(n)&&-1===e.indexOf(n)&&e.push(n)})),e.sort(),i.namespaces=[{namespace:"core"},{namespace:"validation"}].concat(e.map((function(t){var n=a.a.data.extensions[t];return n||(n=Object.values(a.a.data.extensions).find((function(n){var i=n.name.replace("/","-");return t===i}))),{namespace:t,extension:n}})))}))]).then((function(){i.ready=!0,m.redraw()}))},i.content=function(){return m(".ExtensionPage-settings",m(".container",[this.contentTab()]))},i.infoItems=function(){var n=this,i=t.prototype.infoItems.call(this);return i.add("linguist-tabs",m("ul.FoF-Linguist-Tabs",[m("li",m("a",{className:"strings"===this.tab?"active":"",onclick:function(){n.tab="strings"}},a.a.translator.trans("fof-linguist.admin.tabs.strings"))),m("li",m("a",{className:"coverage"===this.tab?"active":"",onclick:function(){n.tab="coverage"}},a.a.translator.trans("fof-linguist.admin.tabs.coverage")))]),100),i},i.contentTab=function(){var t=this;if(!this.ready)return d.a.component();switch(this.tab){case"strings":return m(j,{namespaces:this.namespaces,initialBrowseFilters:this.initialBrowseFilters});case"coverage":return m(q,{namespaces:this.namespaces,browseWithFilters:function(n){t.initialBrowseFilters=n,t.tab="strings"}})}return null},n}(p.a);a.a.initializers.add("fof-linguist",(function(t){t.store.models["fof-linguist-string-key"]=u,t.store.models["fof-linguist-string"]=f,t.extensionData.for("fof-linguist").registerPage(R)}))}]);
//# sourceMappingURL=admin.js.map