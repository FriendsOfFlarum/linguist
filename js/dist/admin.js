module.exports=function(t){var n={};function i(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=n,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var s in t)i.d(e,s,function(n){return t[n]}.bind(null,s));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=14)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat.Model},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["components/Select"]},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,n){t.exports=flarum.core.compat["components/AdminNav"]},function(t,n){t.exports=flarum.core.compat["components/Page"]},function(t,n){t.exports=flarum.core.compat["components/ExtensionsPage"]},function(t,n){t.exports=flarum.core.compat["components/Alert"]},function(t,n){t.exports=flarum.core.compat["components/LoadingModal"]},function(t,n){t.exports=flarum.core.compat["utils/extractText"]},function(t,n){t.exports=flarum.core.compat["utils/ItemList"]},function(t,n,i){"use strict";i.r(n);var e=i(5),s=i(0),o=i.n(s),a=i(6),r=i.n(a),l=i(7),u=i.n(l);function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function g(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}var h=i(2),p=i.n(h),d=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),s=0;s<i;s++)e[s]=arguments[s];return g(c(n=t.call.apply(t,[this].concat(e))||this),"key",p.a.attribute("key")),g(c(n),"locales",p.a.attribute("locales")),n}return f(n,t),n}(p.a),y=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),s=0;s<i;s++)e[s]=arguments[s];return g(c(n=t.call.apply(t,[this].concat(e))||this),"key",p.a.attribute("key")),g(c(n),"locale",p.a.attribute("locale")),g(c(n),"value",p.a.attribute("value")),n}return f(n,t),n.prototype.apiEndpoint=function(){return"/fof/linguist/strings"+(this.exists?"/"+this.data.id:"")},n}(p.a),v=i(8),b=i.n(v),x=i(1),w=i.n(x),F=i(3),k=i.n(F),T=i(4),L=i.n(T),O=i(9),S=i.n(O),K=i(10),E=i.n(K),P=i(11),N=i.n(P),B=i(12),I=i.n(B),j=function(){var t=[];for(var n in o.a.data.locales)o.a.data.locales.hasOwnProperty(n)&&t.push({key:n,name:o.a.data.locales[n]});return t},C=i(13),_=i.n(C),q=function(t,n){if(!n)return t;var i=n.toLowerCase(),e=new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i");return t.replace(e,"<fof-highlight>$&<fof-highlight>").split("<fof-highlight>").map((function(t){return t.toLowerCase()===i?m("span.FoF-Linguist-Highlight",t):t}))},R=function(){function t(){}var n=t.prototype;return n.oninit=function(t){var n=this;this.stringKey=t.attrs.stringKey,this.locale=t.attrs.locale,this.localeKey=this.locale?this.locale.key:null,this.originalString=this.localeKey&&this.stringKey.locales().hasOwnProperty(this.localeKey)?this.stringKey.locales()[this.localeKey]:null,this.string=o.a.store.all("fof-linguist-string").find((function(t){return t.key()===n.stringKey.key()&&t.locale()===n.localeKey})),this.value=this.string?this.string.value():"",this.dirty=!1,this.processing=!1;var i=Object.keys(this.stringKey.locales()).some((function(t){return-1!==n.stringKey.locales()[t].indexOf("\n")}));this.inputType="input",(i||-1!==this.value.indexOf("\n"))&&(this.inputType="textarea")},n.view=function(t){var n=this,i=this.originalString?this.originalString:"("+o.a.translator.trans("fof-linguist.admin.placeholder."+(this.localeKey?"not-translated":"all-locales"))+")";return m(".FoF-Linguist-Locale",[m("label.FoF-Linguist-Label",this.localeName()),m(".FoF-Linguist-Field",{className:(this.value?"FoF-Linguist-Field--with-value":"")+(this.originalString?" FoF-Linguist-Field--with-original-string":""),title:i},[m(".FoF-Linguist-Field-Wrap",[m(this.inputType,{className:"FormControl FoF-Linguist-Input",value:this.value,oninput:function(t){n.value=t.target.value,n.dirty=!0,n.value||n.string||(n.dirty=!1)},disabled:this.processing}),m(".FoF-Linguist-Placeholder",[m("span.FoF-Linguist-Placeholder-Hint",o.a.translator.trans("fof-linguist.admin.placeholder.hint"))," ",m("span",this.originalString?q(i,t.attrs.highlight):i)])])]),m(".FoF-Linguist-Controls",this.actions(t.attrs.onchange).toArray())])},n.localeName=function(){return this.locale?[this.locale.name+" (",m("code",this.locale.key),")"]:o.a.translator.trans("fof-linguist.admin.locales.all")},n.actions=function(t){var n=this,i=new _.a;return i.add("apply",w.a.component({type:"button",className:"Button Button--primary",loading:this.processing,disabled:!this.dirty,onclick:function(){n.saveString(t)}},o.a.translator.trans("fof-linguist.admin.buttons.apply"))),i.add("reset",w.a.component({type:"button",className:"Button",loading:this.processing,disabled:!this.dirty&&!this.string,onclick:function(){n.deleteString(t)}},o.a.translator.trans("fof-linguist.admin.buttons.reset"))),this.originalString&&i.add("copy-original",w.a.component({type:"button",className:"Button",loading:this.processing,onclick:function(){n.value=n.originalString,n.dirty=!0}},o.a.translator.trans("fof-linguist.admin.buttons.copy-original"))),i},n.saveString=function(t){var n=this;this.value?(this.string||(this.string=o.a.store.createRecord("fof-linguist-string",{attributes:{key:this.stringKey.key(),locale:this.localeKey,value:""}})),this.string.data.attributes.value=this.value,this.string.locale()||delete this.string.data.attributes.locale,this.processing=!0,this.string.save(this.string.data.attributes).then((function(){n.processing=!1,n.dirty=!1,t(),m.redraw()})).catch((function(t){throw n.processing=!1,t}))):this.deleteString(t)},n.deleteString=function(t){var n=this;this.string?(this.processing=!0,this.string.delete().then((function(){n.processing=!1,n.dirty=!1,n.string=null,n.value="",t(),m.redraw()})).catch((function(t){throw n.processing=!1,t}))):(this.value="",this.dirty=!1)},t}(),M=function(){function t(){}return t.prototype.view=function(t){var n=t.attrs,i=n.stringKey,e=n.highlight,s=n.onchange;return m(".FoF-Linguist-Key",[m(".FoF-Linguist-Key-Code",m("code",q(i.key(),e))),m(".FoF-Linguist-Locales",[].concat(j().map((function(t){return m(R,{key:t.key,locale:t,stringKey:i,highlight:e,onchange:s})})),[m(R,{key:"all",locale:null,stringKey:i,highlight:e,onchange:s})]))])},t}(),A=function(t){function n(){return t.apply(this,arguments)||this}f(n,t);var i=n.prototype;return i.oninit=function(n){var i=this;t.prototype.oninit.call(this,n),this.numberOfResultsToShow=20,this.filters={search:"",withOwnTranslations:!1,missingTranslationsNegation:"without",missingTranslationsType:"any",missingTranslationsInLocales:[],forExtension:null},this.results=[],this.extensions=[],Promise.all([o.a.request({method:"GET",url:o.a.forum.attribute("apiUrl")+"/fof/linguist/strings"}).then((function(t){o.a.store.pushPayload(t)})),o.a.request({method:"GET",url:o.a.forum.attribute("apiUrl")+"/fof/linguist/string-keys"}).then((function(t){var n=o.a.store.pushPayload(t);Object.keys(o.a.data.extensions).forEach((function(t){var e=o.a.data.extensions[t];S.a.prototype.isEnabled(t)&&!e.extra.hasOwnProperty("flarum-locale")&&i.extensions.push({extension:e,canBeTranslated:-1!==n.findIndex((function(n){return 0===n.key().indexOf(t+".")}))})}))}))]).then((function(){i.applyFilters()}))},i.view=function(){var t=this,n=this.results.slice(0,this.numberOfResultsToShow);return m(".container",[m("div","1"===o.a.data.settings["fof.linguist.should-clear-cache"]?E.a.component({dismissible:!1,controls:[w.a.component({className:"Button Button--link",onclick:function(){o.a.modal.show(N.a),o.a.request({method:"DELETE",url:o.a.forum.attribute("apiUrl")+"/cache"}).then((function(){return window.location.reload()}))}},o.a.translator.trans("fof-linguist.admin.clear-cache.button"))]},o.a.translator.trans("fof-linguist.admin.clear-cache.text")):null),m(".FoF-Linguist-Filters",[m("input.FormControl",{value:this.filters.search,oninput:function(n){t.filters.search=n.target.value,t.applyFilters()},placeholder:o.a.translator.trans("fof-linguist.admin.filters.search")}),w.a.component({className:"Button"+(this.filters.withOwnTranslations?" FoF-Linguist-Filter--Selected":""),icon:"far fa-"+(this.filters.withOwnTranslations?"check-square":"square"),onclick:function(){t.filters.withOwnTranslations=!t.filters.withOwnTranslations,t.applyFilters()}},o.a.translator.trans("fof-linguist.admin.filters.with-own-translations")),k.a.component({buttonClassName:"Button"+(this.filters.forExtension?" FoF-Linguist-Filter--Selected":""),label:o.a.translator.trans("fof-linguist.admin.filters.for-extension")},this.extensions.map((function(n){return w.a.component({className:"Button"+(n.canBeTranslated?"":" disabled"),icon:"far fa-"+(t.filters.forExtension===n.extension.id?"check-square":"square"),onclick:function(i){if(!n.canBeTranslated)return i.stopPropagation(),void alert(I()(o.a.translator.trans("fof-linguist.admin.filters.for-extension-unavailable",{namespace:n.extension.id})));t.filters.forExtension===n.extension.id?t.filters.forExtension=null:t.filters.forExtension=n.extension.id,t.applyFilters()}},n.extension.extra["flarum-extension"].title)}))),k.a.component({buttonClassName:"Button"+(this.filters.missingTranslationsInLocale?" FoF-Linguist-Filter--Selected":""),label:o.a.translator.trans("fof-linguist.admin.filters.missing")},[m(".FoF-Linguist-Missing-Filter",{onclick:function(t){t.stopPropagation()}},[L.a.component({value:this.filters.missingTranslationsNegation,onchange:function(n){t.filters.missingTranslationsNegation=n,t.filters.missingTranslationsInLocale&&t.applyFilters()},options:{without:o.a.translator.trans("fof-linguist.admin.filters.negation-options.without"),with:o.a.translator.trans("fof-linguist.admin.filters.negation-options.with")}}),L.a.component({value:this.filters.missingTranslationsType,onchange:function(n){t.filters.missingTranslationsType=n,t.filters.missingTranslationsInLocale&&t.applyFilters()},options:{any:o.a.translator.trans("fof-linguist.admin.filters.type-options.any"),original:o.a.translator.trans("fof-linguist.admin.filters.type-options.original"),own:o.a.translator.trans("fof-linguist.admin.filters.type-options.own")}}),m("p",o.a.translator.trans("fof-linguist.admin.filters.missing-middle-label"))])].concat(j().map((function(n){return w.a.component({className:"Button",icon:"far fa-"+(t.filters.missingTranslationsInLocale===n.key?"check-square":"square"),onclick:function(){t.filters.missingTranslationsInLocale===n.key?t.filters.missingTranslationsInLocale=null:t.filters.missingTranslationsInLocale=n.key,t.applyFilters()}},n.name+" ("+n.key+")")}))))]),m("div",n.map((function(n){return m(M,{key:n.id(),stringKey:n,highlight:t.filters.search,onchange:function(){o.a.data.settings["fof.linguist.should-clear-cache"]="1"}})}))),m(".FoF-Linguist-Results",[o.a.translator.trans("fof-linguist.admin.filters.results",{shown:n.length+"",total:this.results.length+""})," ",this.results.length>n.length?w.a.component({className:"Button",onclick:function(){t.numberOfResultsToShow+=20}},o.a.translator.trans("fof-linguist.admin.buttons.load-more")):null])])},i.applyFilters=function(){var t=this;this.numberOfResultsToShow=20;var n=o.a.store.all("fof-linguist-string").map((function(t){return t.key()})),i={};j().forEach((function(t){i[t.key]=o.a.store.all("fof-linguist-string").filter((function(n){return n.locale()===t.key})).map((function(t){return t.key()}))}));var e="";this.filters.search&&(e=this.filters.search.toLowerCase()),this.results=o.a.store.all("fof-linguist-string-key").filter((function(s){if(t.filters.withOwnTranslations&&-1===n.indexOf(s.key()))return!1;if(t.filters.missingTranslationsInLocale){var o=s.locales().hasOwnProperty(t.filters.missingTranslationsInLocale),a=-1!==i[t.filters.missingTranslationsInLocale].indexOf(s.key()),r=!1;switch(t.filters.missingTranslationsType){case"any":r=o||a;break;case"original":r=o;break;case"own":r=a}if("without"===t.filters.missingTranslationsNegation&&(r=!r),!r)return!1}if(t.filters.forExtension&&0!==s.key().indexOf(t.filters.forExtension+"."))return!1;if(e){if(-1!==s.key().toLowerCase().indexOf(e))return!0;var l=s.locales();for(var u in l)if(l.hasOwnProperty(u)&&-1!==l[u].toLowerCase().indexOf(e))return!0;return!1}return!0})),m.redraw()},n}(b.a);o.a.initializers.add("fof-linguist",(function(t){t.store.models["fof-linguist-string-key"]=d,t.store.models["fof-linguist-string"]=y,t.routes["fof-linguist-strings"]={path:"/linguist",component:A},t.extensionSettings["fof-linguist"]=function(){return m.route.set(t.route("fof-linguist-strings"))},Object(e.extend)(u.a.prototype,"items",(function(n){n.add("fof-linguist-strings",r.a.component({href:t.route("fof-linguist-strings"),icon:"fas fa-italic",description:t.translator.trans("fof-linguist.admin.menu.description")},t.translator.trans("fof-linguist.admin.menu.title")))}))}))}]);
//# sourceMappingURL=admin.js.map